
<section id = "showcase" class="row">
  <div class="col-md-12">
    <div id="Carousel" class="center carousel slide" data-ride="carousel">
      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#Carousel" data-slide-to="0" class="active"></li>
        <li data-target="#Carousel" data-slide-to="1"></li>
        <li data-target="#Carousel" data-slide-to="2"></li>
      </ol>

      <!-- Wrapper for Slides -->
      <div class="carousel-inner">
        <div class="item active">
          <img src="http://placehold.it/1200x400/20BFA9/ffffff&text=This is Third example">
        </div>
        <div class="item">
          <img src="http://placehold.it/1200x400/20BFA9/ffffff&text=This is Third example">

        </div>
        <div class="item">
          <img src="http://placehold.it/1200x400/20BFA9/ffffff&text=This is Third example">
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#Carousel" data-slide="prev">
          <span class="icon-prev"></span>
        </a>
        <a class="right carousel-control" href="#Carousel" data-slide="next">
          <span class="icon-next"></span>
        </a>
      </div>
    </div><!--slider-->
  </div>
</section>

<section class="row information">
  <div class="col-sm-12 panel panel-default">
    <div class="col-sm-8">
      <h2><%= @store.name %></h2>
      <input type="hidden" id="store_id" value="<%= @store.id %>">
      <table class="table">
        <tbody>
          <tr>
            <td class = "col-sm-2"><span class="label label-primary">Market</span></td>
            <td><%= @store.market.name %></td>
          </tr>
          <tr>
            <td class = "col-sm-2"><span class="label label-primary">Location</span></td>
            <td><%= @store.market.city %>, <%= @store.market.state%>, <%= @store.market.zipcode %></td>
          </tr>
          <tr>
            <td class = "col-sm-2"><span class="label label-primary">Open time</span></td>
            <td><%= get_day_from_timestamp(@store.open_time) %>    <%= get_time_from_timestamp(@store.open_time) %> - <%= get_time_from_timestamp(@store.open_time) %></td>
          </tr>
          <tr>
            <td class = "col-sm-2"><span class="label label-primary">Description</span></td>
            <td><%= @store.description %></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="col-sm-4 well">
      <div id="rating">
        <h4>Average user rating</h4>
        <h2 class="bold padding-bottom-7">UNKNOW <small>/ 5</small></h2>
        <% (0..4).each do |i|%>
        <% if i >= 0 %>
        <button type="button" class="btn btn-default btn-sm" aria-label="Left Align">
          <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
        </button>
        <% else %>
        <button type="button" class="btn btn-warning btn-sm" aria-label="Left Align">
          <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
        </button>
        <% end %>
        <% end %>
      </div>
      <hr>
      <%= link_to 'Market', @store.market, class: "btn btn-success text-right" %>
      <span class="label label-primary">Owner</span>
      <%= link_to @store.vendor.user.name, @store.vendor, class: "btn btn-success text-right" %>
    </div>
  </div>
</section>

<section>
  <div id="store_details" class="carousel slide details" >
    <ul class="nav nav-pills nav-justified">
      <li data-target="#store_details" data-slide-to="0" class="active"><a href="#">Product</a></li>
      <li data-target="#store_details" data-slide-to="1"><a href="#">Review</a></li>
    </ul>



    <!-- Wrapper for slides -->
    <div class="carousel-inner">
      <div class="item active">
        <div id = "store_products">
          <%= render 'products', locals: { products: @products } %>
        </div>
        <div id="products_next" class="btn btn-default col-sm-12">Show More Products</div>
        <input type="hidden" id="current_product_page" value="<%= @current_page %>">
      </div><!-- End Item -->

      <div class="item">
        <div class="row">
          <div class="col-md-12">
            <img src="http://placehold.it/1200x400/20BFA9/ffffff&text=This is Third example">
          </div>
        </div>
        <hr>

        <div id = "store_reviews" class="text-center">
          <img src="http://placehold.it/1200x100/20BFA9/ffffff&text=This is Third example">
        </div>
      </div><!-- End Item -->

    </div><!-- End Carousel Inner -->
  </div>
</section>
<script>
$('#store_details').on('click', '.nav a', function() {
    clickEvent = true;
    $('.nav li').removeClass('active');
    $(this).parent().addClass('active');
}).on('slid.bs.carousel', function(e) {
  if(!clickEvent) {
    var count = $('.nav').children().length -1;
    var current = $('.nav li.active');
    current.removeClass('active').next().addClass('active');
    var id = parseInt(current.data('slide-to'));
    if(count == id) {
      $('.nav li').first().addClass('active');
    }
  }
  clickEvent = false;
});

$("#products_next").click(function() {
  $.ajax({
    url: "/stores/"+ $("#store_id").val() +"/products",
    dataType: "html",
    type: "GET",
    data: "current_product_page=" + $("#current_product_page").val(),
    success: function(data, success) {
      $('#store_products').append(data);
      $('#current_product_page').val(parseInt($("#current_product_page").val()) + 1);
    },
    error: function(data, failure) {
      alert(success);
    }
  });
});

</script>
