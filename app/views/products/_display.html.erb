<% if product.is_special %>
<div class="row row-special">
<% else %>
<div class="row">
<% end %>
  <div class="col-md-12">
    <div class="col-md-5">
      <div id="Carousel" class="center carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
          <li data-target="#Carousel" data-slide-to="0" class="active"></li>
          <% (1..product.product_images.length-1).each do |i|%>
          <li data-target="#Carousel" data-slide-to="<%= i %>"></li>
          <% end %>
        </ol>

        <!-- Wrapper for Slides -->
        <div class="carousel-inner">
          <% if product.product_images.all.length == 0 %>
          <div class="item active">
            <div class="text-center thumbnail-image thumbnail-image-square" style="background:url(http://placehold.it/150x150/fff/ffffff&text='')"><span class="glyphicon-md glyphicon glyphicon glyphicon-apple"></span></div>
          </div>
          <% else %>
          <div class="item active">
            <div class="text-center thumbnail-image thumbnail-image-square" style="background:url(<%= product.product_images.all.first.image.url(:large) %>)"></div>
          </div>
          <% @product.product_images[1..-1].each do |product_image|%>
          <div class="item">
            <div class="text-center thumbnail-image thumbnail-image-square" style="background:url(<%= product_image.image.url(:large) %>)"></div>
          </div>
          <% end %>
          <% end %>
          <!-- Controls -->
          <a class="left carousel-control" href="#Carousel" data-slide="prev">
            <span class="icon-prev"></span>
          </a>
          <a class="right carousel-control" href="#Carousel" data-slide="next">
            <span class="icon-next"></span>
          </a>
        </div>
      </div><!--slider-->
    </div>

    <div class="col-md-7">
      <div class="product-name"><%= product.name %></div>
      <div class="product-description"><%= product.description %></div>
      <div class="product-discount"><i class="fa fa-star gold"></i> <i class="fa fa-star gold"></i> <i class="fa fa-star gold"></i> <i class="fa fa-star gold"></i> <i class="fa fa-star-o"></i> </div>
      <hr>
      <div class="row">
        <% if product.is_special %>
        <div class="col-sm-2">
          <span class="glyphicon-active glyphicon-sm glyphicon glyphicon-piggy-bank"></span>
        </div>
        <div class="col-sm-10">
          <div class="product-price product-price-active"><%= product.price %></div>
        </div>

        <% else %>
        <div class="col-sm-2">
          <span class="glyphicon-sm glyphicon glyphicon-piggy-bank"></span>
        </div>
        <div class="col-sm-10">
          <div class="product-price"><%= product.price %></div>
        </div>

        <% end %>
      </div>
      <div class="row">
        <div class="col-sm-2">
          <span class="glyphicon-sm glyphicon glyphicon-flag"></span>
        </div>
        <div class="col-sm-10">
          <h4 class="tags">
            <% split_tags(product.tag).each do |tag| %>
              <div class="label label-tags label-warning"><%= tag %></div>
            <% end %>
          </h4>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        <% if logged_in? %>
        <% if ShoppingList.where(product_id: product.id, user_id: current_user.id).all.first%>
                <button type="button" class="btn btn-default delShoppingList" value="<%= product.id%>">Delete List</button>
        <% else %>
                <button type="button" class="btn btn-success addShoppingList" value="<%= product.id%>">Add To List</button>
        <% end %>

        <% end %>
      </div>
    </div>
  </div>
</div>
<style>
.product-price-active{
  color: rgba(66,120,12,0.5);

}
.glyphicon-active{
  color: rgba(66,120,12,0.5);
}
</style>
<script>
$(".addShoppingList").click(function() {
  var btn = $(this);
  $.ajax({
    url: "/shopping_lists",
    dataType: "json",
    type: "POST",
    data: {product_id: btn.attr('value')},
    success: function(data, success) {
      btn.removeClass('btn-success')
      btn.addClass('btn-default')
      btn.removeClass('addShoppingList')
      btn.addClass('delShoppingList')
      $("#checkProductPanel").modal('hide');
      alert(data['statue']);
    },
    error: function(data, failure) {
      alert(data['status']);
    }
  });
});

$(".delShoppingList").click(function() {
  var btn = $(this);
  $.ajax({
    url: "/shopping_lists/" +  btn.attr('value'),
    dataType: "json",
    type: "DELETE",
    success: function(data, success) {
      btn.removeClass('btn-default')
      btn.addClass('btn-success')
      btn.removeClass('delShoppingList')
      btn.addClass('addShoppingList')
      $("#checkProductPanel").modal('hide');
      alert(data['statue']);
    },
    error: function(data, failure) {
      alert(data['status']);
    }
  });
});
</script>
